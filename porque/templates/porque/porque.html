{% extends 'miapp/base.html' %}

{% block title %}5 POR QUÉ{% endblock %}

{% block content %}
<div class="form-container">
    <h1 id="analisis-5w" class="text-center">5 POR QUÉ</h1>

    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <form method="post" class="analisis-5w-form">
        {% csrf_token %}
    
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="area">Área</label>
                <select id="area" name="area" class="form-control">
                    <option value="">Seleccione un área</option>
                    {% for opcion in opciones_area %}
                        <option value="{{ opcion }}">{{ opcion }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group col-md-6">
                <label for="subarea">Subarea</label>
                <select id="subarea" name="subarea" class="form-control">
                    <option value="">Seleccione una línea</option>
                    {% for opcion in opciones_subarea %}
                        <option value="{{ opcion }}">{{ opcion }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
    
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="maquina">Maquina</label>
                <select id="maquina" name="maquina" class="form-control">
                    <option value="">Seleccione una subcategoría</option>
                    {% for opcion in opciones_maquina %}
                    <option value="{{ opcion }}">{{ opcion }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group col-md-6">
                <label for="miembros">Miembros del equipo</label>
                <select id="miembros" name="miembros_equipo" class="form-control" multiple>
                    {% for miembro in opciones_miembros %}
                        <option value="{{ miembro.id }}" data-email="{{ miembro.email }}">
                            {{ miembro.nombre }}
                        </option>
                    {% endfor %}
                </select> 
            </div>
        </div>
    
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="pilar">Pilar</label>
                <input type="text" id="pilar" name="pilar" class="form-control">
            </div>
            <div class="form-group col-md-6">
                <label for="impacto">Impacto</label>
                <input type="text" id="impacto" name="impacto" class="form-control">
            </div>
        </div>
    
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="kpi_iceo">KPI ICEO</label>
                <input type="text" id="kpi_iceo" name="kpi_iceo" class="form-control">
            </div>
            <div class="form-group col-md-6">
                <label for="kpi_secundario">KPI Secundario(KAI)</label>
                <select id="kpi_secundario" name="kpi_secundario" class="form-control">
                    <option value="">Seleccione un KPI secundario</option>
                    <option value="kpi1">Eficiencia Global de Equipos (OEE)</option>
                    <option value="kpi2">Tasa de Defectos</option>
                    <option value="kpi3">Tiempo Medio Entre Fallos (MTBF)</option>
                </select>
            </div>
        </div>
    
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="fecha_inicio">Fecha Inicio</label>
                <input type="date" id="fecha_inicio" name="fecha_inicio" class="form-control" value="2024-09-10">
            </div>
            <div class="form-group col-md-6">
                <label for="fecha_cierre">Fecha Estimada de Cierre</label>
                <input type="date" id="fecha_cierre" name="fecha_cierre" class="form-control">
            </div>
        </div>
    
        <div class="form-actions">
            <button type="button" class="btn btn-secondary">Cancelar</button>
            <button type="submit" class="btn btn-primary">Guardar y Continuar</button>
        </div>
    </form>
</div>

<!-- Incluir Select2 y jQuery -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<!-- Inicialización de Select2 -->
<script type="text/javascript">
    $(document).ready(function() {
        function formatState (state) {
            if (!state.id) {
                return state.text;
            }
            var email = $(state.element).data('email');
            var $state = $(
                '<span><strong>' + state.text + '</strong><br/><small>' + email + '</small></span>'
            );
            return $state;
        }

        $('#miembros').select2({
            placeholder: "Selecciona miembros del equipo",
            templateResult: formatState,
            templateSelection: formatState,
            allowClear: true
        });
    });
</script>

{% endblock %}
